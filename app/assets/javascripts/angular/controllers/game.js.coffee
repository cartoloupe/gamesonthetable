# This code creates the moves controller, which is used in game.html.erb
movesApp.controller 'MovesController', [
  'MoveResource'
  '$scope'
  'dispatcher'
  (MoveResource, $scope, dispatcher) ->

    dispatcher.bind 'moves', 'reddot', (coordinate) ->
      console.log 'moves reddot from game.js.coffee'
      console.log coordinate

    # Get all of the moves from the server. Just a regular http get.
    MoveResource.all (moves) ->
      $scope.moves = moves
      return
    MoveResource.onCreate (move) ->
      $scope.moves.push move
      return
    $scope.newMove = new MoveResource

    $scope.saveMove = ->
      $scope.newMove.save (move) ->
        # $scope.moves.push(move);
        $scope.newMove = new MoveResource
        return
      return

    $scope.destroyMove = ->
      $scope.newMove.destroy()
      return

    $('.another-move').on 'click', (d, i) ->
      a = $('.another-move').text()
      delta = parseInt(a)
      submitMove parseInt(a)
      circle = $('svg circle')
      circle_cx = parseInt(circle.attr('cx'))
      circle.attr 'cx', circle_cx + delta
      circle.remove()
      $('svg').append circle
      dispatcher.trigger 'moves.moving', cx: circle_cx
      return

    return
]

submitMove = (value) ->
  $.post '/moves', move: number_of_moves: value
  return

movesList = (message) ->
  return


$(document).ready ->
  #dispatcher = new WebSocketRails(window.location.host + '/websocket')

  $('#submit-move').on 'click', ->
    submitMove $('#new-move').val()
    return

  return

# ---
# generated by js2coffee 2.0.4








